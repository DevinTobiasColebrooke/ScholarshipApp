<% organization ||= local_assigns[:organization] %>
<h2 class="text-2xl font-semibold text-gray-800 mb-4">Financial Metrics</h2>
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm mb-8 border-b pb-6">
  <div class="p-3 bg-gray-50 rounded-lg">
    <p class="font-semibold text-gray-700">Total Revenue (Part I):</p>
    <p class="text-lg font-bold text-gray-900"><%= number_to_currency(organization.cy_total_revenue_amt, precision: 0) %></p>
  </div>
  <div class="p-3 bg-gray-50 rounded-lg">
    <p class="font-semibold text-gray-700">Qualifying Distributions (Part XI):</p>
    <p class="text-lg font-bold text-gray-900"><%= number_to_currency(organization.qualifying_distributions_amt, precision: 0) %></p>
  </div>
  <div class="p-3 bg-gray-50 rounded-lg">
    <p class="font-semibold text-gray-700">FMV Total Assets (Index I):</p>
    <p class="text-lg font-bold text-gray-900"><%= number_to_currency(organization.fmv_assets_eoy_amt, precision: 0) %></p>
  </div>

  <%# Supplemental Info is a large block, render it separately, giving it organization context %>
  <%= render 'organizations/details/supplemental_info', organization: organization %>
  
  <% if organization.approved_future_grants_xml_amt && organization.approved_future_grants_xml_amt > 0 %>
    <div class="p-3 bg-green-50 rounded-lg sm:col-span-3">
      <p class="font-semibold text-green-700">Approved Future Grants (Part XV):</p>
      <p class="text-lg font-bold text-green-900">
        <%= number_to_currency(organization.approved_future_grants_xml_amt, precision: 0) %>
        <span class="font-normal text-sm text-green-700">(Purpose: <%= organization.approved_future_grants_purpose.truncate(100) %>)</span>
      </p>
    </div>
  <% end %>

  <% total_paid = organization.total_grants_paid_xml_amt.to_d rescue 0 %>
  <% if total_paid > 0 %>
    <div class="p-3 bg-blue-50 rounded-lg">
      <p class="font-semibold text-blue-700">Total Grants Paid (Part XIV Total):</p>
      <p class="text-lg font-bold text-blue-900">
        <%= number_to_currency(total_paid, precision: 0) %>
      </p>
    </div>
  <% end %>

  <% total_apprv_fut = organization.total_grant_or_contri_apprv_fut_amt.to_d rescue 0 %>
  <% if total_apprv_fut > 0 && total_apprv_fut != (organization.approved_future_grants_xml_amt.to_d rescue 0) %>
    <div class="p-3 bg-blue-50 rounded-lg">
      <p class="font-semibold text-blue-700">Total Approved Future Grants (Part XV Total):</p>
      <p class="text-lg font-bold text-blue-900">
        <%= number_to_currency(total_apprv_fut, precision: 0) %>
      </p>
    </div>
  <% end %>
</div>